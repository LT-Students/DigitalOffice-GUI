@using System.Threading.Tasks;
@using LT.DigitalOffice.GUI.Services.Interfaces;
@using LT.DigitalOffice.GUI.Services.ApiClients.CompanyService;
@using LT.DigitalOffice.GUI.Properties;

@inject ICompanyService companyService

<EditForm Model="@_positionData" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <div class="create-position_container">
        <div class="item-groop">
            <label for="create-department_name">@Resources.PositionName<font color="red">*</font></label>
            <input @bind-value="_positionData.Name"
                   type="text"
                   id="create-position_name"
                   class="form-control"
                   @onkeyup="@((k) => {
                               if (k.Code == "Enter" || k.Code == "ArrowDown")
                                   _descriptionInput.FocusAsync();})" />
            <ValidationMessage style="font-size: 0.7em;" For="() => _positionData.Name" />
        </div>
        <div class="item-groop">
            <label for="create-position_description">@Resources.PositionDescription<font color="red">*</font></label>
            <textarea @bind="_positionData.Description"
                      @ref="_descriptionInput"
                      type="text"
                      id="create-position_description"
                      class="form-control" />
            <ValidationMessage style="font-size: 0.7em;" For="() => _positionData.Description" />
        </div>
        <div class="create-position_actions-container">
            <p class="info_container">@_message</p>
            <button class="btn btn-primary" type="submit">@Resources.CreatePosition</button>
        </div>
    </div>
</EditForm>

@code {
    private CreatePositionRequest _positionData = new();
    private string _message;
    private ElementReference _descriptionInput;

    private async Task HandleValidSubmit()
    {
        _message = await companyService.CreatePosition(_positionData);
    }
}
