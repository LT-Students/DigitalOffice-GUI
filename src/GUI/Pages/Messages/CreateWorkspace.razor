@using Helpers
@using Services.ApiClients.MessageService
@using Services.Interfaces
@using LT.DigitalOffice.GUI.Shared

@inject IMessageService _MessageService;

<div class=@(IsOpenCreateWorkspaceWindow ? "create-workspace-window" : "create-workspace-window-hide")>
    <p>Create workspace</p>
    <hr>

    <label for="name">Name</label>
    <input id="name" @bind=@_request.Name type="text" class="form-control" aria-describedby="basic-addon1" />

    <label for="description">Description</label>
    <textarea rows="3" @bind=@_request.Description id="description" type="text" class="form-control"
        aria-describedby="basic-addon1"></textarea>

    <label for="image">Image</label>

    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#snackbar-modal"
        @onclick="CreateWorkspaceAsync">
        Finish
    </button>

    <Snackbar DataTarget="snackbar-modal" IsSuccessOperation=@_isSuccessOperation Message=@_messageUser />
</div>


@code {
    [Parameter]
    public bool IsOpenCreateWorkspaceWindow { get; set; }
    
    private string _messageUser;
    private bool _isSuccessOperation;

    private WorkspaceRequest _request { get; set; }

    protected override void OnInitialized()
    {
        _request = new();
    }

    public async Task CreateWorkspaceAsync()
    {

        try
        {
            var response = await _MessageService.CreateWorkspace(_request);

            if (response.Status == OperationResultStatusType.FullSuccess)
            {
                _messageUser = $"The task was created successfully!";
                _isSuccessOperation = true;

                return;
            }

            _messageUser = $"Something went wrong, please try again later.\nMessage: { response.Errors }";
        }
        catch (ApiException<ErrorResponse> ex)
        {
            _isSuccessOperation = false;
            _messageUser = $"Something went wrong, please try again later.\nMessage: { ex.Result.Message }";
        }
        catch (Exception ex)
        {
            _isSuccessOperation = false;
            _messageUser = $"Something went wrong, please try again later.";
        }
    }
}