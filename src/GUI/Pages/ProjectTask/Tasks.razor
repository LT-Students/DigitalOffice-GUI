@using LT.DigitalOffice.GUI.Properties

@page "/tasks"

@using LT.DigitalOffice.GUI.Pages.ProjectTask.CreateTask
@using LT.DigitalOffice.GUI.Pages.ProjectTask.TaskWindow

@inject NavigationManager UriHelper

<div class="nav-scroller bg-body shadow-sm">
    <nav class="nav nav-underline" aria-label="Tasks navigation">
        <a 
            href="javascript:void(0)"
            class="nav-link" 
            data-toggle="modal"
            data-target="#сreate-task-modal-center">
                @Resources.CreateNewTask
            </a>
    </nav>
</div>

    <CreateTaskModalWindow />
    
    <TaskModalWindow @ref="_taskModalWindow"/>

<div class="tasks">
    <div class="overflow-auto">

        @if (_tasks is not null)
        {
            @foreach (var task in _tasks)
            {
                Guid taskId = task.Id;

                <div class="task" @onclick="() => _taskModalWindow.GetTaskAsync(taskId)" data-toggle="modal" data-target="#task-modal-center">
                    <div style="padding: 1% 2%;">

                        <div class="task-content_general-info">
                            <h2>#@task.Number</h2>
                            <div>
                                <h1>@task.Project.ShortName - @task.Name</h1>
                            </div>
                            <h2 style="@(GetTaskTypeStyle(task.TypeName))">@task.TypeName</h2>
                        </div>
                        <div>
                            <div class="task-content_additional-info">
                                <h2>@Resources.TaskAssigned: 
                                    <NavLink style=@UserLinkStyle href=@{$"/assigned/{task.AssignedTo?.Id}"}>
                                        @(task.AssignedTo != null ? 
                                            string.Join(" ", task.AssignedTo.FirstName, task.AssignedTo.LastName) : "-")
                                    </NavLink>
                                </h2>
                                <h2>@Resources.TaskAuthor:
                                    <NavLink style=@UserLinkStyle href=@{$"/assigned/{task.Author.Id}"}>
                                        @(task.Author != null ? 
                                            string.Join(" ", task.Author.FirstName, task.Author.LastName) : "-")
                                    </NavLink>
                                </h2>
                                <h2>@Resources.TaskStatus: @task.StatusName</h2>
                                <h2>@Resources.TaskPriority: @task.PriorityName</h2>
                                <h2>@Resources.TaskLeadTime: @task.PlannedMinutes</h2> 
                            </div>
                        </div>

                    </div>
                </div>
            }
        }
    </div>

    @if (_tasks is not null && _tasks.Count >= TakeCount && _tasks.Count != _totalCount)
    {
        <button type="button" class="btn btn-primary" id="showMore" @onclick="GetTasks">@Resources.ShowMore</button>
    }

</div>
